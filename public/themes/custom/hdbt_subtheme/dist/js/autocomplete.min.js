!function(){const e=Drupal.t("Use current Location",{},{context:"Helsinki near you"}),{currentLanguage:t}=drupalSettings.path,i="geolocation"in navigator?[{label:`\n  <div>\n    <span class="hel-icon hel-icon--locate" role="img" aria-hidden="true"></span>\n    ${e}\n  </div>\n`,value:e,index:0,item:{label:e,value:e}}]:[],n=()=>{const e=document.createElement("div");e.innerHTML=Drupal.t("Couldn't retrieve location. Please type desired address manually",{},{context:"Helsinki near you"});const t=document.querySelector(".helfi-etusivu-near-you-form__errors");t.innerHTML="",t.appendChild(e)},s=(e,t)=>{e.disabled=t,t?e.addClasses(e.input,e.options.classes.inputLoading):(e.removeClasses(e.input,e.options.classes.inputLoading),e.close())};((Drupal,o)=>{const a=o=>{if(!A11yAutocomplete)throw new Error("A11yAutocomplete object not found. Make sure the library is loaded.");if(!drupalSettings.helsinki_near_you_form)throw new Error("Helsinki near you form object not found. Configuration cannot be loaded for autocomplete.");const{autocompleteRoute:a,noResultsAssistiveHint:l,someResultsAssistiveHint:r,oneResultAssistiveHint:u,highlightedAssistiveHint:c,inputAssistiveHint:d,minCharAssistiveHint:p}=drupalSettings.helsinki_near_you_form,v=A11yAutocomplete(o,{classes:{inputLoading:"loading",wrapper:"helfi-etusivu-autocomplete"},highlightedAssistiveHint:c,inputAssistiveHint:d,minCharAssistiveHint:p,minChars:0,noResultsAssistiveHint:l,oneResultAssistiveHint:u,someResultsAssistiveHint:r,source:async(e,t)=>{if(e.length<3)return t(i);try{const n=await fetch(`${a}?q=${e}`),s=await n.json();t(i.concat(s))}catch(e){console.error(e),t(i)}}})._internal_object;o.addEventListener("autocomplete-select",(i=>{i.detail.selected.value===e&&(i.preventDefault(),s(v,!0),navigator.geolocation.getCurrentPosition((async e=>{const{coords:{latitude:n,longitude:s}}=e,o=new URLSearchParams({lat:n,lon:s}),a=new URL("https://api.hel.fi/servicemap/v2/address/");a.search=o.toString();const l=await fetch(a.toString()),r=await l.json();var u;i.target.value=(u=r.results[0].full_name)[t]?u[t]:u.fi?u.fi:Object.values(u)[0]})),s(v,!1))})),o.addEventListener("focus",(()=>{n(),""===v.input.value&&i.length&&v.displayResults(i)}))};Drupal.behaviors.helfi_etusivu_autocomplete={attach(e){o("a11y_autocomplete_element","[data-helfi-etusivu-autocomplete]",e).forEach(a)}}})(Drupal,once)}();