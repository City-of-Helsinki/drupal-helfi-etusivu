!function(){const e=Drupal.t("Use current Location",{},{context:"Helsinki near you"}),t="location-loading",{currentLanguage:i}=drupalSettings.path,n="geolocation"in navigator?[{label:`\n  <div>\n    <span class="hel-icon hel-icon--locate" role="img" aria-hidden="true"></span>\n    ${e}\n  </div>\n`,value:e,index:0,item:{label:e,value:e}}]:[],s=()=>{const e=document.createElement("section");e.classList.add("hds-notification","hds-notification--error"),e.setAttribute("aria-label",Drupal.t("Notification"));const t=document.createElement("div");t.classList.add("hds-notification__content");const i=document.createElement("div");i.classList.add("hds-notification__label"),i.setAttribute("role","heading"),i.setAttribute("aria-level","2");const n=document.createElement("span");n.classList.add("hel-icon","hel-icon--error"),n.setAttribute("role","img"),n.setAttribute("aria-hidden","true"),i.appendChild(n);const s=document.createElement("span");s.innerHTML=Drupal.t("Location determination unsuccessful",{},{context:"Helsinki near you"}),i.appendChild(s);const o=document.createElement("div");o.classList.add("hds-notification__body"),o.innerHTML=Drupal.t("Please type desired address manually",{},{context:"Helsinki near you"}),t.appendChild(i),t.appendChild(o),e.appendChild(t);const a=document.querySelector(".helfi-etusivu-near-you-form__errors");a.innerHTML="",a.appendChild(e)},o=(e,i,n)=>{i.close(),n?e.classList.toggle(t,!0):e.classList.toggle(t,!1)};((Drupal,a)=>{const l=a=>{if(!A11yAutocomplete)throw new Error("A11yAutocomplete object not found. Make sure the library is loaded.");if(!drupalSettings.helsinki_near_you_form)throw new Error("Helsinki near you form object not found. Configuration cannot be loaded for autocomplete.");const{autocompleteRoute:l,noResultsAssistiveHint:r,someResultsAssistiveHint:c,oneResultAssistiveHint:u,highlightedAssistiveHint:d,inputAssistiveHint:h,minCharAssistiveHint:p}=drupalSettings.helsinki_near_you_form,m=A11yAutocomplete(a,{classes:{inputLoading:"loading",wrapper:"helfi-etusivu-autocomplete"},highlightedAssistiveHint:d,inputAssistiveHint:h,minCharAssistiveHint:p,minChars:0,noResultsAssistiveHint:r,oneResultAssistiveHint:u,someResultsAssistiveHint:c,source:async(e,t)=>{if(e.length<3)return t(n);try{const i=await fetch(`${l}?q=${e}`),s=await i.json();t(n.concat(s))}catch(e){console.error(e),t(n)}}})._internal_object;a.addEventListener("autocomplete-select",(t=>{t.detail.selected.value===e&&(t.preventDefault(),o(a,m,!0),navigator.geolocation.getCurrentPosition((async e=>{const{coords:{latitude:n,longitude:l}}=e;if(!n||!l)return s(),void o(a,m,!1);const r=new URLSearchParams({lat:n,lon:l}),c=new URL("https://api.hel.fi/servicemap/v2/address/");c.search=r.toString();try{const e=await fetch(c.toString()),n=await e.json();t.target.value=(u=n.results[0].full_name)[i]?u[i]:u.fi?u.fi:Object.values(u)[0]}catch(e){s()}finally{o(a,m,!1)}var u})))})),a.addEventListener("focus",(()=>{a.classList.contains(t)||""===m.input.value&&n.length&&m.displayResults(n)})),a.addEventListener("keydown",(e=>{""===m.input.value&&n.length&&0===m.suggestions.length&&"ArrowDown"===e.key&&m.displayResults(n)}))};Drupal.behaviors.helfi_etusivu_autocomplete={attach(e){a("a11y_autocomplete_element","[data-helfi-etusivu-autocomplete]",e).forEach(l)}}})(Drupal,once)}();