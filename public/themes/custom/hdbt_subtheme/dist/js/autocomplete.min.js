!function(){const t=Drupal.t("Use current Location",{},{context:"Helsinki near you"}),e="location-loading",{currentLanguage:n}=drupalSettings.path,s=`\n  <div>\n    <span class="hel-icon hel-icon--locate" role="img" aria-hidden="true"></span>\n    ${t}\n  </div>\n`;((Drupal,i)=>{const o=i=>{if(!A11yAutocomplete)throw new Error("A11yAutocomplete object not found. Make sure the library is loaded.");if(!drupalSettings.helsinki_near_you_form)throw new Error("Helsinki near you form object not found. Configuration cannot be loaded for autocomplete.");let o="geolocation"in navigator?[{label:s,value:t,index:0,item:{label:t,value:t}}]:[];const a=i.closest(".hds-text-input"),l=()=>{a.classList.add("hds-text-input--invalid");const t=document.createElement("span");t.classList.add("hds-text-input__error-text"),t.textContent=Drupal.t("We couldn't retrieve your current location. Try entering an address.",{},{context:"Helsinki near you"}),a.appendChild(t),o=[]},{autocompleteRoute:r,noResultsAssistiveHint:u,someResultsAssistiveHint:c,oneResultAssistiveHint:d,highlightedAssistiveHint:h,inputAssistiveHint:v,minCharAssistiveHint:p}=drupalSettings.helsinki_near_you_form,g=A11yAutocomplete(i,{classes:{inputLoading:"loading",wrapper:"helfi-etusivu-autocomplete"},highlightedAssistiveHint:h,inputAssistiveHint:v,minCharAssistiveHint:p,minChars:0,noResultsAssistiveHint:u,oneResultAssistiveHint:d,someResultsAssistiveHint:c,source:async(t,e)=>{if(t.length<3)return e(o);try{const n=await fetch(`${r}?q=${t}`),s=await n.json();e(o.concat(s))}catch(t){console.error(t),e(o)}}})._internal_object,m=t=>{g.close(),t?i.classList.toggle(e,!0):i.classList.toggle(e,!1)};i.addEventListener("autocomplete-select",(e=>{e.detail.selected.value===t&&(e.preventDefault(),m(i),navigator.geolocation.getCurrentPosition((async t=>{const{coords:{latitude:s,longitude:i}}=t,o=new URLSearchParams({lat:s,lon:i}),a=new URL("https://api.hel.fi/servicemap/v2/address/");a.search=o.toString();try{const t=await fetch(a.toString()),s=await t.json();e.target.value=(r=s.results[0].full_name)[n]?r[n]:r.fi?r.fi:Object.values(r)[0]}catch(t){l()}finally{m(!1)}var r}),(()=>{l(),m(!1)})))})),i.addEventListener("focus",(()=>{i.classList.contains(e)||""===g.input.value&&o.length&&g.displayResults(o)})),i.addEventListener("keydown",(t=>{""===g.input.value&&o.length&&0===g.suggestions.length&&"ArrowDown"===t.key&&g.displayResults(o)})),i.addEventListener("change",(()=>{a.classList.remove("hds-text-input--invalid"),a.querySelector(".hds-text-input__error-text").remove()}))};Drupal.behaviors.helfi_etusivu_autocomplete={attach(t){i("a11y_autocomplete_element","[data-helfi-etusivu-autocomplete]",t).forEach(o)}}})(Drupal,once)}();