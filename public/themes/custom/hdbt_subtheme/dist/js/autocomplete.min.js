!function(){const e=Drupal.t("Use current Location",{},{context:"Helsinki near you"}),t="location-loading",{currentLanguage:s}=drupalSettings.path,i=`\n  <div>\n    <span class="hel-icon hel-icon--locate" role="img" aria-hidden="true"></span>\n    ${e}\n  </div>\n`;((Drupal,n)=>{const a=n=>{if(!A11yAutocomplete)throw new Error("A11yAutocomplete object not found. Make sure the library is loaded.");if(!drupalSettings.helsinki_near_you_form)throw new Error("Helsinki near you form object not found. Configuration cannot be loaded for autocomplete.");let a="geolocation"in navigator?[{label:i,value:e,index:0,item:{label:e,value:e}}]:[];const o=n.closest(".hds-text-input"),l=()=>{o.classList.add("hds-text-input--invalid");const e=document.createElement("span");e.classList.add("hds-text-input__error-text"),e.textContent=Drupal.t("Failed to retrieve device location. Please type the address manually.",{},{context:"Helsinki near you"}),o.appendChild(e),a=[]},{autocompleteRoute:r,noResultsAssistiveHint:u,someResultsAssistiveHint:c,oneResultAssistiveHint:d,highlightedAssistiveHint:h,inputAssistiveHint:v,minCharAssistiveHint:p}=drupalSettings.helsinki_near_you_form,g=A11yAutocomplete(n,{classes:{inputLoading:"loading",wrapper:"helfi-etusivu-autocomplete"},highlightedAssistiveHint:h,inputAssistiveHint:v,minCharAssistiveHint:p,minChars:0,noResultsAssistiveHint:u,oneResultAssistiveHint:d,someResultsAssistiveHint:c,source:async(e,t)=>{if(e.length<3)return t(a);try{const s=await fetch(`${r}?q=${e}`),i=await s.json();t(a.concat(i))}catch(e){console.error(e),t(a)}}})._internal_object,m=e=>{g.close(),e?n.classList.toggle(t,!0):n.classList.toggle(t,!1)};n.addEventListener("autocomplete-select",(t=>{t.detail.selected.value===e&&(t.preventDefault(),m(n),navigator.geolocation.getCurrentPosition((async e=>{const{coords:{latitude:i,longitude:n}}=e,a=new URLSearchParams({lat:i,lon:n}),o=new URL("https://api.hel.fi/servicemap/v2/address/");o.search=a.toString();try{const e=await fetch(o.toString()),i=await e.json();t.target.value=(r=i.results[0].full_name)[s]?r[s]:r.fi?r.fi:Object.values(r)[0]}catch(e){l()}finally{m(!1)}var r}),(()=>{l(),m(!1)})))})),n.addEventListener("focus",(()=>{n.classList.contains(t)||""===g.input.value&&a.length&&g.displayResults(a)})),n.addEventListener("keydown",(e=>{""===g.input.value&&a.length&&0===g.suggestions.length&&"ArrowDown"===e.key&&g.displayResults(a)})),n.addEventListener("change",(()=>{o.classList.remove("hds-text-input--invalid"),o.querySelector(".hds-text-input__error-text").remove()}))};Drupal.behaviors.helfi_etusivu_autocomplete={attach(e){n("a11y_autocomplete_element","[data-helfi-etusivu-autocomplete]",e).forEach(a)}}})(Drupal,once)}();