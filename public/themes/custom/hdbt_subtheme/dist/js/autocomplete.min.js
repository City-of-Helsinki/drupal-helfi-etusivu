!function(){const e=Drupal.t("Use current Location",{},{context:"Helsinki near you"}),t="location-loading",{currentLanguage:i}=drupalSettings.path,n=`\n  <div>\n    <span class="hel-icon hel-icon--locate" role="img" aria-hidden="true"></span>\n    ${e}\n  </div>\n`;((Drupal,s)=>{const o=s=>{if(!A11yAutocomplete)throw new Error("A11yAutocomplete object not found. Make sure the library is loaded.");if(!drupalSettings.helsinki_near_you_form)throw new Error("Helsinki near you form object not found. Configuration cannot be loaded for autocomplete.");let o="geolocation"in navigator?[{label:n,value:e,index:0,item:{label:e,value:e}}]:[];const a=()=>{const e=document.createElement("section");e.classList.add("hds-notification","hds-notification--error"),e.setAttribute("aria-label",Drupal.t("Notification"));const t=document.createElement("div");t.classList.add("hds-notification__content");const i=document.createElement("div");i.classList.add("hds-notification__label"),i.setAttribute("role","heading"),i.setAttribute("aria-level","2");const n=document.createElement("span");n.classList.add("hel-icon","hel-icon--error"),n.setAttribute("role","img"),n.setAttribute("aria-hidden","true"),i.appendChild(n);const s=document.createElement("span");s.innerHTML=Drupal.t("Location determination unsuccessful",{},{context:"Helsinki near you"}),i.appendChild(s);const a=document.createElement("div");a.classList.add("hds-notification__body"),a.innerHTML=Drupal.t("Please type desired address manually",{},{context:"Helsinki near you"}),t.appendChild(i),t.appendChild(a),e.appendChild(t);const l=document.querySelector(".helfi-etusivu-near-you-form__errors");l.innerHTML="",l.appendChild(e),o=[]},{autocompleteRoute:l,noResultsAssistiveHint:r,someResultsAssistiveHint:c,oneResultAssistiveHint:u,highlightedAssistiveHint:d,inputAssistiveHint:h,minCharAssistiveHint:p}=drupalSettings.helsinki_near_you_form,m=A11yAutocomplete(s,{classes:{inputLoading:"loading",wrapper:"helfi-etusivu-autocomplete"},highlightedAssistiveHint:d,inputAssistiveHint:h,minCharAssistiveHint:p,minChars:0,noResultsAssistiveHint:r,oneResultAssistiveHint:u,someResultsAssistiveHint:c,source:async(e,t)=>{if(e.length<3)return t(o);try{const i=await fetch(`${l}?q=${e}`),n=await i.json();t(o.concat(n))}catch(e){console.error(e),t(o)}}})._internal_object,v=e=>{m.close(),e?s.classList.toggle(t,!0):s.classList.toggle(t,!1)};s.addEventListener("autocomplete-select",(t=>{t.detail.selected.value===e&&(t.preventDefault(),v(s),navigator.geolocation.getCurrentPosition((async e=>{const{coords:{latitude:n,longitude:s}}=e,o=new URLSearchParams({lat:n,lon:s}),l=new URL("https://api.hel.fi/servicemap/v2/address/");l.search=o.toString();try{const e=await fetch(l.toString()),n=await e.json();t.target.value=(r=n.results[0].full_name)[i]?r[i]:r.fi?r.fi:Object.values(r)[0]}catch(e){a()}finally{v(!1)}var r}),(()=>{a(),v(!1)})))})),s.addEventListener("focus",(()=>{s.classList.contains(t)||""===m.input.value&&o.length&&m.displayResults(o)})),s.addEventListener("keydown",(e=>{""===m.input.value&&o.length&&0===m.suggestions.length&&"ArrowDown"===e.key&&m.displayResults(o)}))};Drupal.behaviors.helfi_etusivu_autocomplete={attach(e){s("a11y_autocomplete_element","[data-helfi-etusivu-autocomplete]",e).forEach(o)}}})(Drupal,once)}();